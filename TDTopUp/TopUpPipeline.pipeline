<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:coreEntry>
        <con:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType">
            <con:wsdl ref="TDTopUp/Resources/TopUpTD_PS"/>
            <con:binding>
                <con:name>TopUpTD_PS_ptt-binding</con:name>
                <con:namespace>http://xmlns.oracle.com/LOT2/TDTopUp/TopUpTD_PS</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations">
            <oper:monitoring enabled="true" level="service" aggregationInterval="1440"/>
        </oper:operations>
        <con:xqConfiguration>
            <con:snippetVersion>1.0</con:snippetVersion>
        </con:xqConfiguration>
    </con:coreEntry>
    <con:router errorHandler="error-N3f57ff91.57cf67c0.0.1989cf07570.N7c9f">
        <con:pipeline type="response" name="response-N3f57ff87.3fc4bf98.0.1981793aed2.N7fce">
            <con:stage id="_StageId-N3f57ff87.3fc4bf98.0.1981793aed2.N7fcc" name="Stage1">
                <con:context/>
                <con:actions/>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-N3f57ff87.3fc4bf98.0.1981793aed2.N7f8d">
            <con:stage id="_StageId-N3f57ff87.3fc4bf98.0.1981793aed2.N7f8b" name="Stage1">
                <con:context>
                    <con1:varNsDecl prefix="td" namespace="http://www.mozabanca.org/obdx/td_list_basic_details" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="ReqUUID" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7fd7</con2:id>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn-bea:uuid()</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="SessionVal" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a6f8a22.N2824d772.17.198f5cbd026.N7fff</con2:id>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name='X_OBDX_SESSION_PARAM']/@value</con:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:report xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7fe3</con2:id>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">concat('RequestUUID :', $ReqUUID, ' | ', fn:current-dateTime(), ' | ', fn-bea:serialize($body))</con:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>TdTopUpService - Request</con1:key>
                            <con1:varName>body</con1:varName>
                            <con1:value>
                                <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./text()</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7fe0</con2:id>
                        <con1:logLevel>debug</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">concat('RequestUUID :',$ReqUUID,' | ',fn-bea:serialize($body))</con2:xqueryText>
                        </con1:expr>
                        <con1:message>TdTopUpService - Request</con1:message>
                    </con1:log>
                    <con1:assign varName="RequestMapping" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7f1d</con2:id>
                        <con1:expr>
                            <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                <con2:resource ref="TDTopUp/Mapping/TDTopupRequest"/>
                                <con2:param name="Request">
                                    <con2:path>$InitialRequest</con2:path>
                                </con2:param>
                            </con2:xqueryTransform>
                        </con1:expr>
                    </con1:assign>
                    <con1:nxsdTranslation xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7f1a</con2:id>
                        <con1:type>XML-To-Native</con1:type>
                        <con1:sourceExpr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$RequestMapping</con2:xqueryText>
                        </con1:sourceExpr>
                        <con1:nxsd ref="TDTopUp/XSD/RAPP"/>
                        <con1:schemaElement xmlns:cpca="http://www.mozabanca.org/cpca">cpca:Request</con1:schemaElement>
                        <con1:assign-variable>nXSDValue</con1:assign-variable>
                        <con1:enforceSchemaOrder>false</con1:enforceSchemaOrder>
                    </con1:nxsdTranslation>
                    <con1:assign varName="jsonValue" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7f17</con2:id>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn-bea:binary-to-text($nXSDValue[@ref],$text)</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:javaCallout varName="EncodeUrl" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7f14</con2:id>
                        <con1:archive ref="DebitCardList/Resources/JsonToStringUrl"/>
                        <con1:className>demo.MainClass</con1:className>
                        <con1:method>public static java.lang.String encodeJsonToRequestParam(java.lang.String)</con1:method>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$jsonValue</con2:xqueryText>
                        </con1:expr>
                        <con1:return-param-as-ref>false</con1:return-param-as-ref>
                    </con1:javaCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-N3f57ff87.3fc4bf98.0.1981793aed2.N7f22">
            <con:stage id="_StageId-N3f57ff87.3fc4bf98.0.1981793aed2.N7f20" name="Stage1">
                <con:context>
                    <con1:userNsDecl prefix="td" namespace="http://www.mozabanca.org/obdx/td_topup_projection" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl prefix="td1" namespace="http://www.mozabanca.org/obdx/td_list_basic_details" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="principalAmount" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N1829a4a7.0.1985a75bf10.N7fcd</con2:id>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">let $opData := $body/*[local-name() = "CAPDResponse"]/*[local-name() = "operationData"] 
let $rawCapd := $opData/*[local-name() = "CAPD_O_0008"] 
let $capdStr := string($rawCapd) 
let $cleanCapd := replace($capdStr, '^0+', '') (: Remove leading zeros :) 
let $capdLen := string-length($cleanCapd) 
let $capdAmount := if ($capdLen > 2) 
then xs:decimal(concat( substring($cleanCapd, 1, $capdLen - 2), ".", substring($cleanCapd, $capdLen - 1, 2) )) 
else if ($capdLen = 2) then xs:decimal(concat("0.", $cleanCapd)) 
else if ($capdLen = 1) then xs:decimal(concat("0.0", $cleanCapd)) 
else xs:decimal("0.00") (: Now take amount from InitialRequest instead of body :) 

let $rawReq := xs:string($InitialRequest/*:amount/*:amount)
let $reqStr := string($rawReq) 
let $reqAmount := if (contains($reqStr, '.')) then xs:decimal($reqStr) else xs:decimal(concat($reqStr, ".00")) 
let $total := $capdAmount + $reqAmount 

return $total</con:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="currentPrincipal" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a6f8a21.4e7ba6f7.e.19914e0a60e.N8000</con2:id>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">let $opData := $body/*[local-name() = "CAPDResponse"]/*[local-name() = "operationData"]
let $rawCapd := $opData/*[local-name() = "CAPD_O_0008"]
let $capdStr := string($rawCapd)
let $cleanCapd := replace($capdStr, '^0+', '') (: Remove leading zeros :)
let $capdLen := string-length($cleanCapd)
let $capdAmount :=
  if ($capdLen > 2) then
    xs:decimal(concat(
      substring($cleanCapd, 1, $capdLen - 2), ".", 
      substring($cleanCapd, $capdLen - 1, 2)
    ))
  else if ($capdLen = 2) then
    xs:decimal(concat("0.", $cleanCapd))
  else if ($capdLen = 1) then
    xs:decimal(concat("0.0", $cleanCapd))
  else
    xs:decimal("0.00")



return $capdAmount</con:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="tenure" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.449e6439.0.1990e75d79e.N7fc1</con2:id>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">let $days := 
  let $opData := $body/*[local-name() = "CAPDResponse"]/*[local-name() = "operationData"]
  let $startRaw := $opData/*[local-name() = "CAPD_O_0005"]
  let $endRaw := $opData/*[local-name() = "CAPD_O_0006"]
  
  return
    if (string-length($startRaw) = 8 and string-length($endRaw) = 8) then
      let $start := xs:date(concat(substring($startRaw, 1, 4), '-', substring($startRaw, 5, 2), '-', substring($startRaw, 7, 2)))
      let $end := xs:date(concat(substring($endRaw, 1, 4), '-', substring($endRaw, 5, 2), '-', substring($endRaw, 7, 2)))
      return xs:integer(days-from-duration($end - $start))
    else 0

return $days</con:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.449e6439.0.1990e75d79e.N7ffe</con2:id>
                        <con1:service ref="TermDeposit/ProductDetails" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>GetProducts</con1:operation>
                        <con1:request>
                            <con1:payload wrapped="false">ProductRequest</con1:payload>
                        </con1:request>
                        <con1:response>
                            <con1:payload wrapped="false">ProductResponse</con1:payload>
                        </con1:response>
                        <con1:requestTransform>
                            <con3:replace varName="outbound" contents-only="false" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.449e6439.0.1990e75d79e.N7fbe</con4:id>
                                <con3:location>
                                    <con4:xpathText xmlns:con4="http://www.bea.com/wli/sb/stages/config">./ctx:transport/ctx:request</con4:xpathText>
                                </con3:location>
                                <con2:expr>
                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">&lt;request xmlns="http://www.bea.com/wli/sb/context">&lt;headers xsi:type="http:HttpRequestHeaders" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.bea.com/wli/sb/transports" xmlns:http="http://www.bea.com/wli/sb/transports/http">&lt;/headers>&lt;user-metadata name="all" value="all" xmlns="http://www.bea.com/wli/sb/transports"/> &lt;/request></con4:xqueryText>
                                </con2:expr>
                            </con3:replace>
                            <con1:transport-headers copy-all="false">
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.449e6439.0.1990e75d79e.N7fca</con2:id>
                                <con1:header-set>outbound-request</con1:header-set>
                                <con1:header value="expression" name="Authorization">
                                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">concat('Bearer ',$accessToken)</con2:xqueryText>
                                </con1:header>
                                <con1:header value="expression" name="Accept-Encoding">
                                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'UTF-8'</con2:xqueryText>
                                </con1:header>
                            </con1:transport-headers>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con3:nxsdTranslation xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.449e6439.0.1990e75d79e.N7f89</con4:id>
                                <con2:type>Native-To-XML</con2:type>
                                <con2:sourceExpr>
                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">concat('{ "Response" :', $ProductResponse,'}')</con4:xqueryText>
                                </con2:sourceExpr>
                                <con2:nxsd ref="TermDeposit/Resources/Schema/GetTDProductDetails"/>
                                <con2:schemaElement xmlns:get="http://www.mozabank.org/getTDProductDetails">get:ResponseList</con2:schemaElement>
                                <con3:replace-body-content/>
                                <con2:enforceSchemaOrder>false</con2:enforceSchemaOrder>
                            </con3:nxsdTranslation>
                            <con1:assign varName="nXSD">
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a6f8a21.4e7ba6f7.5.19913ab4b80.N8000</con2:id>
                                <con1:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body/*</con:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="revisedInterestRate">
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.449e6439.0.1990e75d79e.N7fc4</con2:id>
                                <con1:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">(
  for $r in $body/*:ResponseList/*:Response
  let $minValue := xs:decimal(replace(replace($r/*:VALOR_MINIMO/text(), '\.', ''), ',.* MZN$', ''))
  let $maxValue := xs:decimal(replace(replace($r/*:VALOR_MAXIMO/text(), '\.', ''), ',.* MZN$', ''))
  let $minTenure := xs:integer($r/*:PRAZO_MINIMO/text())
  let $maxTenure := xs:integer($r/*:PRAZO_MAXIMO/text())
  let $offerDesc := normalize-space($r/*:DESCRICAO_COMPONENTE/text())
  let $condition := 
        xs:decimal($principalAmount) >= $minValue
    and xs:decimal($principalAmount) &lt;= $maxValue
    and xs:integer($tenure) >= $minTenure
    and xs:integer($tenure) &lt;= $maxTenure
    and $offerDesc = $ProductName
  where $condition
  return xs:decimal($r/*:TAXA_JURO/text())
)</con:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:responseTransform>
                    </con1:wsCallout>
                    <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N33d41270.0.198503a0e56.N7ffe</con2:id>
                        <con1:service ref="TermDeposit/MaturityAmount" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>MaturityAmount</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">MaturityAmountRequest</con1:body>
                            <con1:header/>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">MaturityAmountResponse</con1:body>
                            <con1:header/>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:transport-headers copy-all="false">
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N33d41270.0.198503a0e56.N7ff5</con2:id>
                                <con1:header-set>outbound-request</con1:header-set>
                                <con1:header value="expression" name="Authorization">
                                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">concat('Bearer ',$accessToken)</con2:xqueryText>
                                </con1:header>
                            </con1:transport-headers>
                            <con1:assign varName="MaturityAmountRequest">
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N33d41270.0.198503a0e56.N7ff8</con2:id>
                                <con1:expr>
                                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<mat:MaturityRequest xmlns:mat="http://www.mozabank.org/maturityAmount">
  <mat:user>{fn:data($InitialRequest/*:partyId)}</mat:user>
  <mat:capital>{$principalAmount}</mat:capital>
  <mat:interestRate>{$revisedInterestRate}</mat:interestRate>
<mat:days>{$tenure}</mat:days>
</mat:MaturityRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:assign varName="MaturityAmount">
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N33d41270.0.198503a0e56.N7ffb</con2:id>
                                <con1:expr>
                                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($MaturityAmountResponse/*:maturityAmount)</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:responseTransform>
                    </con1:wsCallout>
                    <con1:replace contents-only="true" varName="body" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7d09</con2:id>
                        <con1:expr>
                            <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                                <con:resource ref="TDTopUp/Mapping/projectionResponse"/>
                                <con:param name="current">
                                    <con:path>$currentPrincipal</con:path>
                                </con:param>
                                <con:param name="Maturityamount">
                                    <con:path>$MaturityAmount</con:path>
                                </con:param>
                                <con:param name="Request">
                                    <con:path>$InitialRequest</con:path>
                                </con:param>
                                <con:param name="currency">
                                    <con:path>$currency</con:path>
                                </con:param>
                                <con:param name="InterestRate">
                                    <con:path>$revisedInterestRate</con:path>
                                </con:param>
                                <con:param name="message">
                                    <con:path>$message</con:path>
                                </con:param>
                                <con:param name="principalAmount">
                                    <con:path>$principalAmount</con:path>
                                </con:param>
                                <con:param name="status">
                                    <con:path>$status</con:path>
                                </con:param>
                            </con:xqueryTransform>
                        </con1:expr>
                    </con1:replace>
                    <con1:report xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7fef</con2:id>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">concat('ResponseUUID :', $ReqUUID, ' | ', fn:current-dateTime(), ' | ', fn-bea:serialize($body))</con:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>TdProjectionService - Response</con1:key>
                            <con1:varName>body</con1:varName>
                            <con1:value>
                                <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./text()</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7fec</con2:id>
                        <con1:logLevel>debug</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">concat('ResponseUUID :',$ReqUUID,' | ',fn-bea:serialize($body))</con2:xqueryText>
                        </con1:expr>
                        <con1:message>TdProjectionService - Response</con1:message>
                    </con1:log>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f57ff91.57cf67c0.0.1989cf07570.N7c9f">
            <con:stage id="_StageId-N3f57ff91.57cf67c0.0.1989cf07570.N7bf0" name="Stage1">
                <con:context>
                    <con1:varNsDecl prefix="cas" namespace="http://www.mozabank.org/CASARead" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl prefix="ccdo" namespace="http://www.mozabank.org/ccdo_branch_list" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.57cf67c0.0.1989cf07570.N7bed</con2:id>
                        <con1:case id="_BranchId-N3f57ff91.57cf67c0.0.1989cf07570.N7bec">
                            <con1:condition>
                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound/ctx:service/ctx:operation = 'TdTopUp'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:replace varName="body" contents-only="true">
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.57cf67c0.0.1989cf07570.N7beb</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<Response xmlns="http://www.mozabank.org/td_topup" >
<data>
		<dictionaryArray/>
		<referenceNo/>
		<result>
			<dictionaryArray/>
			<externalReferenceId/>
			<status>FAILURE</status>
			<errorList>
				<code>ERR001</code>
				<message>Invalid backend response</message>
			</errorList>
			<warningList/>
		</result>
		<hasMore/>
		<totalRecords/>
		<startSequence/>
	</data> 
    </Response>]]></con2:xqueryText>
                                    </con1:expr>
                                </con1:replace>
                                <con2:report xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                                    <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7ffb</con3:id>
                                    <con2:expr>
                                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$fault</con3:xqueryText>
                                    </con2:expr>
                                    <con2:labels>
                                        <con2:key>TdTopUpService - Error</con2:key>
                                        <con2:varName>fault</con2:varName>
                                        <con2:value>
                                            <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">./text()</con3:xpathText>
                                        </con2:value>
                                    </con2:labels>
                                </con2:report>
                                <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                                    <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7f30</con3:id>
                                    <con2:logLevel>debug</con2:logLevel>
                                    <con2:expr>
                                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$fault</con3:xqueryText>
                                    </con2:expr>
                                    <con2:message>TdTopUpService - Error</con2:message>
                                </con2:log>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-N3f57ff91.57cf67c0.0.1989cf07570.N7bea">
                            <con1:condition>
                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound/ctx:service/ctx:operation = 'TdProjection'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:replace varName="body" contents-only="true">
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.57cf67c0.0.1989cf07570.N7be9</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<Response xmlns="http://www.mozabank.org/td_topup_projection" >
<data>
		<dictionaryArray/>
		<referenceNo/>
		<result>
			<dictionaryArray/>
			<externalReferenceId/>
			<status>FAILURE</status>
			<errorList>
				<code>ERR001</code>
				<message>Invalid backend response</message>
			</errorList>
			<warningList/>
		</result>
		<hasMore/>
		<totalRecords/>
		<startSequence/>
	</data> 
    </Response>]]></con2:xqueryText>
                                    </con1:expr>
                                </con1:replace>
                                <con2:report xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                                    <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7f33</con3:id>
                                    <con2:expr>
                                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$fault</con3:xqueryText>
                                    </con2:expr>
                                    <con2:labels>
                                        <con2:key>TdProjectionService - Error</con2:key>
                                        <con2:varName>fault</con2:varName>
                                        <con2:value>
                                            <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">./text()</con3:xpathText>
                                        </con2:value>
                                    </con2:labels>
                                </con2:report>
                                <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                                    <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7f2e</con3:id>
                                    <con2:logLevel>debug</con2:logLevel>
                                    <con2:expr>
                                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$fault</con3:xqueryText>
                                    </con2:expr>
                                    <con2:message>TdProjectionService - Error</con2:message>
                                </con2:log>
                            </con1:actions>
                        </con1:case>
                        <con1:default/>
                    </con1:ifThenElse>
                    <con1:reply isError="false" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N3f57ff91.57cf67c0.0.1989cf07570.N7bde</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-N3f57ff87.3fc4bf98.0.1981793aed2.N7f23">
            <con:stage id="_StageId-N3f57ff87.3fc4bf98.0.1981793aed2.N7ebc" name="Stage1">
                <con:context>
                    <con1:varNsDecl prefix="td" namespace="http://www.mozabanca.org/obdx/td_list_basic_details" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="ReqUUID" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7fd3</con2:id>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn-bea:uuid()</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:report xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7fdd</con2:id>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">concat('RequestUUID :', $ReqUUID, ' | ', fn:current-dateTime(), ' | ', fn-bea:serialize($body))</con:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>TdProjectionService - Request</con1:key>
                            <con1:varName>body</con1:varName>
                            <con1:value>
                                <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./text()</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7fda</con2:id>
                        <con1:logLevel>debug</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">concat('RequestUUID :',$ReqUUID,' | ',fn-bea:serialize($body))</con2:xqueryText>
                        </con1:expr>
                        <con1:message>TdProjectionService - Request</con1:message>
                    </con1:log>
                    <con1:assign varName="RequestMapping" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7ebb</con2:id>
                        <con1:expr>
                            <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                <con2:resource ref="TDTopUp/Mapping/TdProjectionRequest"/>
                                <con2:param name="Request">
                                    <con2:path>$InitialRequest</con2:path>
                                </con2:param>
                            </con2:xqueryTransform>
                        </con1:expr>
                    </con1:assign>
                    <con1:nxsdTranslation xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7eba</con2:id>
                        <con1:type>XML-To-Native</con1:type>
                        <con1:sourceExpr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$RequestMapping</con2:xqueryText>
                        </con1:sourceExpr>
                        <con1:nxsd ref="TDTopUp/XSD/CAPD"/>
                        <con1:schemaElement xmlns:capd="http://www.mozabank.org/CAPD">capd:CAPDRequest</con1:schemaElement>
                        <con1:assign-variable>nXSDValue</con1:assign-variable>
                        <con1:enforceSchemaOrder>false</con1:enforceSchemaOrder>
                    </con1:nxsdTranslation>
                    <con1:assign varName="JsonValue" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7eb9</con2:id>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn-bea:binary-to-text($nXSDValue[@ref],$text)</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:javaCallout varName="EncodeUrl" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7eb8</con2:id>
                        <con1:archive ref="DebitCardList/Resources/JsonToStringUrl"/>
                        <con1:className>demo.MainClass</con1:className>
                        <con1:method>public static java.lang.String encodeJsonToRequestParam(java.lang.String)</con1:method>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$JsonValue</con2:xqueryText>
                        </con1:expr>
                        <con1:return-param-as-ref>false</con1:return-param-as-ref>
                    </con1:javaCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-N3f57ff87.3fc4bf98.0.1981793aed2.N7fcf">
            <con:stage id="_StageId-N3f57ff87.3fc4bf98.0.1981793aed2.N7fcd" name="Stage1">
                <con:context/>
                <con:actions>
                    <con1:assign varName="InitialRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7fc9</con2:id>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body/*</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="BranchCode" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.19c66081.0.19850811afb.N7ffe</con2:id>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">string($InitialRequest/*:branchCode)</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7fc6</con2:id>
                        <con1:service ref="AuthenticatorService/AuthenticatorBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>Operation1</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">AuthenticatorRequest</con1:body>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">AuthenticatorResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="AuthenticatorRequest">
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7fc3</con2:id>
                                <con1:expr>
                                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<moz:Request xmlns:moz="http://www.mozabank.org">
    <moz:username>channel_obdx_app</moz:username>
    <moz:password>Moz@Random123#</moz:password>
</moz:Request>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:assign varName="accessToken">
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7fc0</con2:id>
                                <con1:expr>
                                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$AuthenticatorResponse/*:access_token</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-N3f57ff87.3fc4bf98.0.1981793aed2.N7f8c">
            <con:stage id="_StageId-N3f57ff87.3fc4bf98.0.1981793aed2.N7f8a" name="Stage1">
                <con:context>
                    <con1:varNsDecl prefix="td" namespace="http://www.mozabanca.org/obdx/td_list_basic_details" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:replace contents-only="true" varName="body" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7f07</con2:id>
                        <con1:expr>
                            <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                <con2:resource ref="TDTopUp/Mapping/TDTopupResponse"/>
                                <con2:param name="Response">
                                    <con2:path>$body/*</con2:path>
                                </con2:param>
                            </con2:xqueryTransform>
                        </con1:expr>
                    </con1:replace>
                    <con1:report xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7ff5</con2:id>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">concat('ResponseUUID :', $ReqUUID, ' | ', fn:current-dateTime(), ' | ', fn-bea:serialize($body))</con:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>TdTopUpService - Response</con1:key>
                            <con1:varName>body</con1:varName>
                            <con1:value>
                                <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./text()</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7ff2</con2:id>
                        <con1:logLevel>debug</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">concat('ResponseUUID :',$ReqUUID,' | ',fn-bea:serialize($body))</con2:xqueryText>
                        </con1:expr>
                        <con1:message>TdTopUpService - Response</con1:message>
                    </con1:log>
                    <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a6f8a22.N2824d772.16.198f5caad7e.N8000</con2:id>
                        <con1:service ref="SessionParams/DeleteSessionProcess" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>execute</con1:operation>
                        <con1:outboundTransform>
                            <con2:replace varName="body" contents-only="true" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-a6f8a22.N2824d772.17.198f5cbd026.N8000</con3:id>
                                <con2:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">&lt;ses:Query xmlns:ses="http://www.mozabank.org/sessionprocess">
&lt;ses:QueryParam>{$SessionVal}&lt;/ses:QueryParam>
&lt;/ses:Query></con:xqueryText>
                                </con2:expr>
                            </con2:replace>
                        </con1:outboundTransform>
                    </con1:route>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:flow>
            <con:pipeline-node name="Pipeline Pair Node1">
                <con:request>request-N3f57ff87.3fc4bf98.0.1981793aed2.N7fcf</con:request>
                <con:response>response-N3f57ff87.3fc4bf98.0.1981793aed2.N7fce</con:response>
            </con:pipeline-node>
            <con:branch-node type="operation" id="_FlowId-N3f57ff87.3fc4bf98.0.1981793aed2.N7fbf" name="BranchNode1">
                <con:context/>
                <con:branch-table>
                    <con:branch name="TdTopUp">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="Pipeline Pair Node2">
                                <con:request>request-N3f57ff87.3fc4bf98.0.1981793aed2.N7f8d</con:request>
                                <con:response>response-N3f57ff87.3fc4bf98.0.1981793aed2.N7f8c</con:response>
                            </con:pipeline-node>
                            <con:route-node name="RouteNode1">
                                <con:context/>
                                <con:actions>
                                    <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7f10</con2:id>
                                        <con1:service ref="TDTopUp/RAPP_BS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                        <con1:operation>Operation1</con1:operation>
                                        <con1:outboundTransform>
                                            <con2:replace varName="body" contents-only="true" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7f0d</con3:id>
                                                <con2:expr>
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">&lt;RAPPEncodedRequest xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                    xsi:schemaLocation="http://www.mozabanca.org/rapp RAPP.xsd" xmlns="http://www.mozabanca.org/rapp">
  &lt;RequestString>{$EncodeUrl}&lt;/RequestString>
&lt;/RAPPEncodedRequest></con3:xqueryText>
                                                </con2:expr>
                                            </con2:replace>
                                            <con2:report xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-a6f8a22.50650fae.5.199be9467be.N8000</con3:id>
                                                <con2:expr>
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                                                </con2:expr>
                                                <con2:labels>
                                                    <con2:key>TdTopUpService - MSBRequest</con2:key>
                                                    <con2:varName>body</con2:varName>
                                                    <con2:value>
                                                        <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">./text()</con3:xpathText>
                                                    </con2:value>
                                                </con2:labels>
                                            </con2:report>
                                            <con2:transport-headers copy-all="false" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7f0a</con3:id>
                                                <con2:header-set>outbound-request</con2:header-set>
                                                <con2:header value="expression" name="Authorization">
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">concat('Bearer ',$accessToken)</con3:xqueryText>
                                                </con2:header>
                                            </con2:transport-headers>
                                        </con1:outboundTransform>
                                        <con1:responseTransform>
                                            <con2:report xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7f6d</con3:id>
                                                <con2:expr>
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                                                </con2:expr>
                                                <con2:labels>
                                                    <con2:key>TdTopUpService - MSBResponse</con2:key>
                                                    <con2:varName>body</con2:varName>
                                                    <con2:value>
                                                        <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">./text()</con3:xpathText>
                                                    </con2:value>
                                                </con2:labels>
                                            </con2:report>
                                            <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7f39</con3:id>
                                                <con2:logLevel>debug</con2:logLevel>
                                                <con2:expr>
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                                                </con2:expr>
                                                <con2:message>TdTopUpService - MSBResponse</con2:message>
                                            </con2:log>
                                        </con1:responseTransform>
                                    </con1:route>
                                </con:actions>
                            </con:route-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="TdProjection">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="Pipeline Pair Node4">
                                <con:request>request-N3f57ff87.3fc4bf98.0.1981793aed2.N7f23</con:request>
                                <con:response>response-N3f57ff87.3fc4bf98.0.1981793aed2.N7f22</con:response>
                            </con:pipeline-node>
                            <con:route-node name="RouteNode2">
                                <con:context>
                                    <con1:varNsDecl prefix="td" namespace="http://www.mozabanca.org/obdx/td_list_basic_details" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                                </con:context>
                                <con:actions>
                                    <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7e7c</con2:id>
                                        <con1:service ref="TDTopUp/CAPD_BS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                        <con1:operation>Operation1</con1:operation>
                                        <con1:outboundTransform>
                                            <con2:replace varName="body" contents-only="true" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7da5</con3:id>
                                                <con2:expr>
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">&lt;CAPDStringRequest xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                    xsi:schemaLocation="http://www.mozabanca.org/capd CAPD.xsd" xmlns="http://www.mozabanca.org/capd">
  &lt;RequestString>{$EncodeUrl}&lt;/RequestString>
&lt;/CAPDStringRequest></con3:xqueryText>
                                                </con2:expr>
                                            </con2:replace>
                                            <con2:report xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-a6f8a22.50650fae.6.199be97d6b7.N8000</con3:id>
                                                <con2:expr>
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                                                </con2:expr>
                                                <con2:labels>
                                                    <con2:key>TdProjectionService - MSBRequest</con2:key>
                                                    <con2:varName>body</con2:varName>
                                                    <con2:value>
                                                        <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">./text()</con3:xpathText>
                                                    </con2:value>
                                                </con2:labels>
                                            </con2:report>
                                            <con2:transport-headers copy-all="false" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff87.3fc4bf98.0.1981793aed2.N7d71</con3:id>
                                                <con2:header-set>outbound-request</con2:header-set>
                                                <con2:header value="expression" name="Authorization">
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">concat('Bearer ',$accessToken)</con3:xqueryText>
                                                </con2:header>
                                            </con2:transport-headers>
                                        </con1:outboundTransform>
                                        <con1:responseTransform>
                                            <con2:report xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7fe9</con3:id>
                                                <con2:expr>
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                                                </con2:expr>
                                                <con2:labels>
                                                    <con2:key>TdProjectionService - MSBResponse</con2:key>
                                                    <con2:varName>body</con2:varName>
                                                    <con2:value>
                                                        <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">./text()</con3:xpathText>
                                                    </con2:value>
                                                </con2:labels>
                                            </con2:report>
                                            <con2:assign varName="ProductName" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-a6f8a21.4e7ba6f7.b.199147d40d8.N8000</con3:id>
                                                <con2:expr>
                                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:data($body//*[local-name()="CAPD_O_0002"])</con:xqueryText>
                                                </con2:expr>
                                            </con2:assign>
                                            <con2:assign varName="currency" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-a6f8a21.4e7ba6f7.11.19914ea3070.N8000</con3:id>
                                                <con2:expr>
                                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:data($body//*[local-name()="CAPD_O_0009"])</con:xqueryText>
                                                </con2:expr>
                                            </con2:assign>
                                            <con2:assign varName="status" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-a6f8a21.4e7ba6f7.10.19914ea1f0e.N8000</con3:id>
                                                <con2:expr>
                                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:data($body//*[local-name()="errorCode"])</con:xqueryText>
                                                </con2:expr>
                                            </con2:assign>
                                            <con2:assign varName="message" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-a6f8a22.N2824d772.3d.1992eaacff4.N7ffe</con3:id>
                                                <con2:expr>
                                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:data($body//*[local-name()="errorMessage"]/*[local-name()="messages"])</con:xqueryText>
                                                </con2:expr>
                                            </con2:assign>
                                            <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                                                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57ff91.N5490dfa9.0.198a2322658.N7fe6</con3:id>
                                                <con2:logLevel>debug</con2:logLevel>
                                                <con2:expr>
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                                                </con2:expr>
                                                <con2:message>TdProjectionService - MSBResponse</con2:message>
                                            </con2:log>
                                        </con1:responseTransform>
                                    </con1:route>
                                </con:actions>
                            </con:route-node>
                        </con:flow>
                    </con:branch>
                    <con:default-branch>
                        <con:flow/>
                    </con:default-branch>
                </con:branch-table>
            </con:branch-node>
        </con:flow>
    </con:router>
</con:pipelineEntry>